<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Hearify ğŸ™ï¸</title>

  <!-- Hubungkan ke file CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

  <h1>ğŸ§ Hearify</h1>
  <p>Cari lagu dari lirik atau suara ğŸ™ï¸</p>

  <form method="POST">
    <input type="text" id="lyrics" name="lyrics" placeholder="Ketik atau ucapkan lirik..." required>
    <button type="button" id="mic-btn">ğŸ™ï¸</button>
    <button type="submit">Cari Lagu</button>
  </form>

  {% if recognized_text %}
  <p><strong>Hasil suara:</strong> {{ recognized_text }}</p>
  {% endif %}

  <div class="results">
    {% if results %}
      <h2>Hasil Pencarian</h2>
      <ul>
      {% for r in results %}
        <li>
          <div class="song-info">
            {% if r.album_cover %}
            <img src="{{ r.album_cover }}">
            {% endif %}
            <div>
              <b>{{ r.title }}</b><br>
              <span>{{ r.artist }}</span>
            </div>
          </div>

          {% if r.preview %}
            <audio controls>
              <source src="{{ r.preview }}" type="audio/mpeg">
            </audio>
          {% endif %}

          <a href="{{ r.url }}" target="_blank" class="spotify-btn">Open Spotify</a>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <p class="no-result">Tidak ada hasil ditemukan.</p>
    {% endif %}
  </div>

  <footer>
    <p>Dibuat oleh <strong>Cintani Aisyah</strong> â€¢ 23051130004 â€¢ Teknologi Informasi</p>
    <p>Â© 2025 Hearify</p>
  </footer>

  <script>
    const micBtn = document.getElementById("mic-btn");
    const input = document.getElementById("lyrics");
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.lang = "id-ID";

      micBtn.addEventListener("click", () => {
        recognition.start();
        micBtn.textContent = "ğŸ§ Mendengarkan...";
      });

      recognition.onresult = (event) => {
        input.value = event.results[0][0].transcript;
        micBtn.textContent = "ğŸ™ï¸";
      };

      recognition.onerror = () => {
        micBtn.textContent = "ğŸ™ï¸ (Coba lagi)";
      };
    }
  </script>

</body>
</html>
