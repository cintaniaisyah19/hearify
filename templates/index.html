<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hearify ğŸ™ï¸</title>
  <!-- Hubungkan ke file CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§ Hearify</h1>
      <p class="subtitle">Cari lagu dari lirik atau suara ğŸ™ï¸</p>
    </div>

    <form method="POST">
      <input type="text" id="lyrics" name="lyrics" placeholder="Ketik atau ucapkan lirik..." required>
      <button type="button" id="mic-btn">ğŸ™ï¸ Mic</button>
      <button type="submit">Cari Lagu</button>
    </form>

    {% if recognized_text %}
    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(29, 185, 84, 0.1); border-radius: 15px; border: 1px solid rgba(29, 185, 84, 0.3);">
      <strong style="color: #1db954;">Hasil suara:</strong> {{ recognized_text }}
    </div>
    {% endif %}

    <div class="results">
      {% if results %}
        <h2>Hasil Pencarian</h2>
        <div class="results-grid">
        {% for r in results %}
          <div class="song-item">
            <div class="song-info">
              {% if r.album_cover %}
              <img src="{{ r.album_cover }}" alt="{{ r.title }}">
              {% endif %}
              <div class="song-details">
                <h3>{{ r.title }}</h3>
                <p>{{ r.artist }}</p>
              </div>
            </div>
            <div class="song-actions">
              {% if r.preview %}
                <audio controls>
                  <source src="{{ r.preview }}" type="audio/mpeg">
                </audio>
              {% endif %}
              <a href="{{ r.url }}" target="_blank" class="spotify-btn">Open Spotify</a>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <p class="no-results">Tidak ada hasil ditemukan.</p>
      {% endif %}
    </div>

    <footer>
      <p>Dibuat oleh <strong>Cintani Aisyah</strong> â€¢ 23051130004 â€¢ Teknologi Informasi</p>
      <p>Â© 2025 Hearify</p>
    </footer>
  </div>

  <script>
    const micBtn = document.getElementById("mic-btn");
    const input = document.getElementById("lyrics");
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.lang = "id-ID";
      micBtn.addEventListener("click", () => {
        recognition.start();
        micBtn.textContent = "ğŸ§ Mendengarkan...";
      });
      recognition.onresult = (event) => {
        input.value = event.results[0][0].transcript;
        micBtn.textContent = "ğŸ™ï¸ Mic";
      };
      recognition.onerror = () => {
        micBtn.textContent = "ğŸ™ï¸ Coba lagi";
      };
      recognition.onend = () => {
        micBtn.textContent = "ğŸ™ï¸ Mic";
      };
    } else {
      micBtn.disabled = true;
      micBtn.textContent = "ğŸ™ï¸ Tidak Didukung";
    }
  </script>
</body>
</html>
